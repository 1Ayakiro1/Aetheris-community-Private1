import{c,o as r,a as s,a5 as me,a6 as be,a8 as n,a7 as G,an as ye,a9 as _e,i as T,N as o,Z as Q,aj as X,k as Y,ac as f,ap as we,F as L,j as O,ak as ke,_ as Ce,ad as $e,Q as Z,ae as Ne}from"./index-QOySC_5N.js";import{u as Te}from"./useArticles-NJw4-Fx8.js";import"./articles-aP_knVEN.js";const Ae={xmlns:"http://www.w3.org/2000/svg",width:"682.667",height:"682.667",version:"1.0",viewBox:"0 0 512 512"};function Ie(H,m){return r(),c("svg",Ae,[...m[0]||(m[0]=[s("path",{d:"M223 2.2c-5.8 4-7 6.5-8.6 18.9-4.6 35.1-18.7 66.8-41.8 93.1-9 10.4-16.5 16.9-35.2 30.8-49.8 37.3-78.6 88.9-83.5 149.8-4 49.1 12.9 102.7 44.8 142.2 8.6 10.6 25.1 26.4 36.3 34.7 40.9 30.2 90.5 44.1 140.1 39.3 53.5-5.2 101.9-30.9 136.7-72.5 33.3-39.8 50.4-92.8 46.3-143.3-3.8-47.6-20.7-87.2-52.3-122.4-9.7-10.7-12.7-12.8-18.9-12.8-7 0-10.2 2.8-17.9 15.6-6.3 10.6-17.6 25.9-21.7 29.6-1.9 1.7-1.9 1.6-1-6 1.3-11.1.2-36.8-2.2-50.2-7.2-41.1-25.4-77.5-53.6-106.8-12.4-12.9-21.2-20.4-34.1-29C236.7.1 229.6-2.3 223 2.2m32.1 47.4c25.1 20.9 44.5 50.4 54.3 82.6 5.6 18.6 7 28.8 7 49.8 0 20.9-1.3 29.8-7.1 49.3-4.8 16.1-5.1 19.3-2.1 23.6 6 8.8 13.8 10 23.5 3.6 18.6-12.2 38.6-31.1 51.3-48.2 5.8-7.9 7.8-9.9 8.8-9.1 2.5 2.2 15.4 22.2 19.6 30.7 24.2 48.3 24.3 105.8.3 153.8-14.1 28-33.6 50.1-59.5 67.4-37.3 25-84.6 34.3-128.4 25.5C160.6 466 111.5 422.4 92 362.4c-18-55.3-7.6-113.8 28.5-159.9 9.1-11.6 23.1-24.7 39.1-36.6 15.1-11.2 31.1-26.1 40.7-37.9 17.1-21.2 32.2-50.4 38.2-74 .9-3.6 2.1-8.2 2.6-10.3l1-3.9 2.7 1.8c1.5.9 6.1 4.5 10.3 8"},null,-1)])])}const De={render:Ie},Se={class:"create-article-container"},xe={class:"content-wrapper"},Ee={class:"warning-block"},Le={class:"warning-title"},Oe={class:"warning-subtitle"},Fe={class:"read-rules-button"},Re={key:0,class:"image-preview"},Ue=["src"],Ve={key:1,class:"uploading-note"},je={class:"path-block"},Me={class:"edit-title"},Be={class:"edit-subtitle"},qe={class:"edit-block"},Ke={class:"tags-section"},Pe={class:"tags-title"},Je={class:"tags-subtitle"},ze={key:0,class:"selected-tags"},Ge={class:"tag-text"},Qe=["onClick","aria-label"],Xe={class:"tag-input-wrapper"},Ye=["onKeydown","placeholder","disabled"],Ze={key:0,class:"tags-suggestions"},He=["onClick"],We={class:"tags-counter"},et={class:"difficulty-section"},tt={class:"difficulty-title"},st={class:"difficulty-subtitle"},at={class:"difficulty-circles"},nt=["onClick","title"],lt={class:"action-buttons"},ot=["disabled"],it={key:0,class:"pi pi-send button-icon"},ct={key:1,class:"pi pi-spin pi-spinner button-icon"},rt={class:"button-text"},ut=["disabled"],dt={class:"button-text"},pt=["disabled"],vt={class:"button-text"},ft={key:0,class:"api-error"},ht={class:"api-error-message"},gt=me({__name:"CreateArticle",setup(H){const{t:m}=be(),b=n(""),v=n(""),W=$e(),A=n(null),p=n(null),y=n(!1),d={success:["javaScript","vue.js","react","node.js","web development","frontend","tutorial","guide"],info:["python","typescript","angular","programming","backend","database","sql","api","rest"],warning:["design","ui/ux","mobile development","game development","unity","unreal engine","review","interview"],danger:["security","testing","cryptography","devops","docker","kubernetes","blockchain"],secondary:["tools","git","nosql","fullstack","artificial intelligence","machine learning","graphql","microservices","cloud","aws","azure","google cloud","linux","windows","macos","news","case study","architecture","algorithms","design patterns"]},F=n([...d.success,...d.info,...d.warning,...d.danger,...d.secondary]),l=n([]),_=n(""),w=n(!1),k=n("medium"),ee=G(()=>({easy:m("create-article.difficulty.easy"),medium:m("create-article.difficulty.medium"),hard:m("create-article.difficulty.hard")})),C=G(()=>{if(!_.value.trim())return F.value.filter(e=>!l.value.includes(e)).slice(0,10);const t=_.value.toLowerCase();return F.value.filter(e=>e.toLowerCase().includes(t)&&!l.value.includes(e)).slice(0,10)}),{createArticle:te,updateArticle:se,loading:I,error:R}=Te(),ae=ye(),U=n(!1),V=n(null),j=n(!1),M=n(!1),B=n(!1),q=n(!1),K=n(!1),P=n(!1),J=n(!1);console.log("VITE_IMGBB_API_KEY =",void 0);const D=["success","info","warning","danger","secondary"],ne=t=>{if(typeof t=="number")return D[t%D.length];const e=t;if(d.success.includes(e))return"success";if(d.info.includes(e))return"info";if(d.warning.includes(e))return"warning";if(d.danger.includes(e))return"danger";if(d.secondary.includes(e))return"secondary";let a=0;for(let h=0;h<e.length;h++)a=e.charCodeAt(h)+((a<<5)-a);const i=Math.abs(a)%D.length;return D[i]},x=t=>{if(l.value.length>=5){alert("Максимум 5 тегов");return}l.value.includes(t)||(l.value.push(t),_.value="",w.value=!1)},le=t=>{const e=l.value.indexOf(t);e>-1&&l.value.splice(e,1)},oe=()=>{w.value=!0},ie=()=>{const t=_.value.trim();if(!t)return;if(l.value.length>=5){alert("Максимум 5 тегов");return}const e=C.value.find(a=>a.toLowerCase()===t.toLowerCase());e?x(e):C.value.length>0&&x(C.value[0])},ce=t=>{k.value=t},re=t=>{t.target.closest(".tag-input-wrapper")||(w.value=!1)},z=()=>{const e=new DOMParser().parseFromString(v.value,"text/html"),a=S=>{const u=[];return S.childNodes.forEach($=>{if($.nodeType===Node.TEXT_NODE)$.textContent?.trim()&&u.push({type:"text",content:$.textContent});else if($.nodeType===Node.ELEMENT_NODE){const N=$,E=N.tagName.toLowerCase(),g=N.textContent||"";switch(E){case"strong":case"b":u.push({type:"bold",content:g});break;case"em":case"i":u.push({type:"italic",content:g});break;case"u":u.push({type:"underline",content:g});break;case"code":u.push({type:"code",content:g});break;case"a":u.push({type:"link",content:g,href:N.getAttribute("href")||""});break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":u.push({type:"heading",content:g,level:parseInt(E.charAt(1))});break;case"blockquote":u.push({type:"quote",content:g});break;case"ul":case"ol":u.push({type:"list",ordered:E==="ol",items:Array.from(N.querySelectorAll("li")).map(ge=>ge.textContent||"")});break;default:u.push(...a(N));break}}}),u},i=a(e.body);return{title:b.value,content:{html:v.value,formatted:i},tags:l.value,difficulty:k.value,settings:{ranks:{rank1:j.value,rank2:M.value},disableCommenting:B.value,doNotNotify:q.value,hideContacts:K.value,hideCommentatorsInfo:P.value,disableReplying:J.value},createdAt:new Date().toISOString()}},ue=async()=>{if(!b.value.trim()){alert("Пожалуйста, введите заголовок статьи");return}if(!v.value.trim()){alert("Пожалуйста, добавьте содержание статьи");return}try{let t;if(A.value){y.value=!0;try{t=await he(A.value)}catch(i){if(console.error(i),!confirm("Не удалось загрузить превью. Продолжить без него?"))return}finally{y.value=!1}}const e={title:b.value.trim(),content:v.value,excerpt:de(v.value),tags:l.value,status:"published",preview_image:t,difficulty:k.value,author:ae.user?.username||"Anonymous"},a=U.value&&V.value?await se(V.value,e):await te(e);console.log("ArticleData перед API:",e),console.log("Созданная статья:",a),await W.push("/")}catch(t){console.error(t),alert("Ошибка при создании статьи")}},de=t=>{const e=t.replace(/<[^>]*>/g,"");return e.length>200?e.substring(0,200)+"...":e},pe=()=>{const t=z();console.log("Preview data:",JSON.stringify(t,null,2)),alert("Предпросмотр статьи (данные в консоли)")},ve=()=>{const t=z();localStorage.setItem("article_draft",JSON.stringify(t)),alert("Черновик сохранен!")};_e(()=>{document.addEventListener("click",re);const t=localStorage.getItem("article_draft");if(t)try{const e=JSON.parse(t);b.value=e.title||"",l.value=e.tags||[],k.value=e.difficulty||"medium",v.value=e.content?.html||"",e.settings&&(j.value=e.settings.ranks?.rank1||!1,M.value=e.settings.ranks?.rank2||!1,B.value=e.settings.disableCommenting||!1,q.value=e.settings.doNotNotify||!1,K.value=e.settings.hideContacts||!1,P.value=e.settings.hideCommentatorsInfo||!1,J.value=e.settings.disableReplying||!1)}catch(e){console.warn("Не удалось загрузить черновик:",e)}});function fe(t){const e=t.target;if(e.files&&e.files[0]){const a=e.files[0];p.value&&(URL.revokeObjectURL(p.value),p.value=null),A.value=a,p.value=URL.createObjectURL(a)}else p.value&&(URL.revokeObjectURL(p.value),p.value=null),A.value=null}async function he(t){const a="https://api.imgbb.com/1/upload?key=58df18c9866715b1c55a851ab1130bc4",i=new FormData;i.append("image",t);const S=await(await fetch(a,{method:"POST",body:i})).json();if(!S.success)throw new Error("Ошибка загрузки превью на ресурс");return S.data.url}return(t,e)=>(r(),c("div",Se,[s("div",xe,[s("div",Ee,[s("h2",Le,o(t.$t("create-article.h1")),1),s("h2",Oe,o(t.$t("create-article.h2")),1),s("button",Fe,o(t.$t("create-article.button1")),1)]),s("input",{type:"file",onChange:fe,accept:"image/*"},null,32),p.value?(r(),c("div",Re,[e[4]||(e[4]=s("h3",{class:"preview-title"},"Предпросмотр превью:",-1)),s("img",{src:p.value,alt:"Local preview",class:"preview-img"},null,8,Ue)])):T("",!0),y.value?(r(),c("p",Ve,"Загружается превью... Пожалуйста, подождите")):T("",!0),s("div",je,[s("h2",Me,o(t.$t("create-article.h4")),1),s("h2",Be,o(t.$t("create-article.h5")),1),Q(s("input",{type:"text",placeholder:"Enter title...",class:"title-input","onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a)},null,512),[[X,b.value]])]),s("div",qe,[Y(f(we),{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),editorStyle:"height: 500px;"},null,8,["modelValue"]),s("div",Ke,[s("h2",Pe,o(t.$t("create-article.h6")||"Теги статьи"),1),s("h2",Je,o(t.$t("create-article.h7")||"Выберите до 5 тегов для вашей статьи"),1),l.value.length>0?(r(),c("div",ze,[(r(!0),c(L,null,O(l.value,a=>(r(),c("div",{key:a,class:Z(["custom-tag-wrapper",`tag-${ne(a)}`])},[s("span",Ge,o(a),1),s("button",{onClick:i=>le(a),class:"tag-remove-btn",type:"button","aria-label":`Удалить тег ${a}`},[...e[5]||(e[5]=[s("i",{class:"pi pi-times"},null,-1)])],8,Qe)],2))),128))])):T("",!0),s("div",Xe,[Q(s("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),onInput:oe,onFocus:e[3]||(e[3]=a=>w.value=!0),onKeydown:ke(Ce(ie,["prevent"]),["enter"]),placeholder:l.value.length>=5?"Максимум 5 тегов":"Введите тег...",disabled:l.value.length>=5,class:"tags-input-field"},null,40,Ye),[[X,_.value]]),w.value&&C.value.length>0&&l.value.length<5?(r(),c("div",Ze,[(r(!0),c(L,null,O(C.value,a=>(r(),c("div",{key:a,onClick:i=>x(a),class:"suggestion-item"},o(a),9,He))),128))])):T("",!0)]),s("p",We,o(t.$t("create-article.tagsCounter",{count:l.value.length,max:5})),1)]),s("div",et,[s("h2",tt,o(t.$t("create-article.h8")),1),s("h2",st,o(t.$t("create-article.h9")),1),s("div",at,[(r(!0),c(L,null,O(ee.value,(a,i)=>(r(),c("button",{key:i,class:Z(["difficulty-circle",`difficulty-${i}`,{selected:k.value===i}]),onClick:h=>ce(i),type:"button",title:a},[Y(f(De),{class:"difficulty-icon"})],10,nt))),128))])]),s("div",lt,[s("button",{class:"create-button",onClick:ue,disabled:f(I)||y.value},[f(I)?(r(),c("i",ct)):(r(),c("i",it)),s("p",rt,o(U.value?t.$t("create-article.button5"):t.$t("create-article.button2")),1)],8,ot),s("button",{class:"preview-button",onClick:pe,disabled:f(I)||y.value},[e[6]||(e[6]=s("i",{class:"pi pi-eye button-icon"},null,-1)),s("p",dt,o(t.$t("create-article.button3")),1)],8,ut),s("button",{class:"draft-button",onClick:ve,disabled:f(I)||y.value},[e[7]||(e[7]=s("i",{class:"pi pi-save button-icon"},null,-1)),s("p",vt,o(t.$t("create-article.button4")),1)],8,pt)]),f(R)?(r(),c("div",ft,[s("p",ht,o(f(R)),1)])):T("",!0)])])]))}}),_t=Ne(gt,[["__scopeId","data-v-b152d722"]]);export{_t as default};
